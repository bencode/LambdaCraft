# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

LambdaCraft is a Clojure notebook-based platform for studying mathematics, practicing code, and exploring computational thinking using [Clerk](https://clerk.vision/). The project follows the philosophy: `() => study(math) => practice(code)`.

## Development Commands

### Environment Setup
```bash
# Install font dependencies (run once per machine)
pnpm install
```

### Development Workflow
```bash
# Start interactive development server with REPL (recommended for development)
clojure -M:dev

# Start notebook server without REPL
clojure -M:run

# Build static site for deployment
clojure -X:build

# Deploy to GitHub Pages (from project root)
./apps/web/deploy.sh
```

### Server Configuration
- **Development Port**: 7777
- **Server URL**: http://localhost:7777
- **Watch Paths**: `["src" "pages" "docs"]`
- **Index Page**: `pages/home.clj`

### REPL Commands
```clojure
;; Start/stop server
(u/start!)           ; Start server with default options
(clerk/halt!)        ; Stop server

;; Show specific notebook
(clerk/show! "pages/home.clj")
```

## Architecture

### Core Technologies
- **Clojure** (1.12.2) - Primary language
- **Clerk** (0.18.1150) - Interactive notebook system
- **Emmy** (0.32.0) - Computer algebra system for mathematics
- **Emmy Viewers** (0.3.2) - Mathematical visualizations
- **pnpm** - Package manager for font dependencies

### Directory Structure
```
apps/web/
├── src/user.clj           # Server configuration and entry point
├── pages/                 # Published content notebooks
│   ├── home.clj          # Homepage
│   ├── treasure.clj      # Resources collection
│   ├── sicm.clj          # SICM book navigation
│   └── learning/         # Learning notebooks (e.g., SICM exercises)
├── docs/                  # Documentation notebooks
│   ├── clerk.clj         # Clerk feature showcase
│   ├── emmy.clj          # Emmy mathematical computing
│   ├── cider-shortcuts.clj # CIDER shortcuts reference
│   └── home.clj          # Documentation index
├── books/                 # Book readers (render markdown as notebooks)
│   └── sicm/             # SICM reader notebooks
│       ├── contents.clj  # Table of contents
│       ├── preface.clj   # Preface and acknowledgments
│       └── ch1.clj       # Chapter 1
├── public/                # Static build output (gitignored)
├── resources/             # Static assets (CSS, etc.)
└── deps.edn              # Clojure dependencies and aliases

books/
└── sicm/                  # SICM markdown source files
    ├── 0.0-preface.md
    ├── 1.0-Lagrangian_Mechanics.md
    └── ...
```

### Notebook-Based Architecture
- **Pages**: Public content accessible from the main site
- **Docs**: Supporting documentation and technical showcases
- **Static Generation**: Clerk notebooks compile to static HTML/EDN files
- **Hot Reloading**: Automatic updates during development

## Content Creation

### Adding New Notebooks
1. Create `.clj` file in `pages/` (for public content) or `docs/` (for documentation)
2. Subdirectories are supported (e.g., `pages/learning/sicm-1-4.clj`)
3. Use Clerk's viewer syntax for interactive elements
4. Follow naming convention: `kebab-case.clj`
5. Add to appropriate navigation if needed (e.g., `pages/home.clj`)

### Content Structure
```clojure
(ns pages.my-notebook
  (:require [nextjournal.clerk :as clerk]))

;; Control code visibility with metadata
^{:nextjournal.clerk/visibility {:code :hide}}
(clerk/html [:div "This code is hidden"])

;; Use markdown comments for formatted text
;; ## Section Title
;; Regular paragraph text

;; Link to static assets
^{:nextjournal.clerk/visibility {:code :hide}}
(clerk/html [:link {:rel "stylesheet" :href "/css/style.css"}])
```

## Build System

### deps.edn Aliases
- `:dev` - Interactive development with REPL (empty alias, loads `user` ns)
- `:run` - Start notebook server (main-opts: `-m user`)
- `:build` - Generate static site (exec-fn: `nextjournal.clerk/build!`)

### Build Process
1. Clerk processes all `.clj` files matching `pages/*.clj`, `pages/**/*.clj`, `docs/*.clj`, `docs/**/*.clj`
2. Generates static HTML/EDN files in `public/` directory
3. Index page is set to `pages/home.clj`
4. Deployment script copies `public/` contents to `docs/` for GitHub Pages

## Deployment

### GitHub Pages
- **Custom Domain**: qijun.io
- **Branch**: gh-pages (generated by deploy script)
- **Build Output**: `public/` directory

### Deploy Script
The `deploy.sh` script:
1. Builds static site with `clojure -X:build`
2. Switches to `gh-pages` branch
3. Copies build artifacts to `docs/`
4. Creates `.nojekyll` and `CNAME` files
5. Commits and force pushes to origin

## Development Guidelines

### Code Style
- Follow idiomatic Clojure with 2-space indentation
- Use kebab-case for namespaces, vars, and files
- Keep functions pure when possible
- Use docstrings for non-obvious helpers

### File Organization
- Keep notebooks focused on single topics
- Separate public content (`pages/`) from documentation (`docs/`)
- Maintain clear navigation structure

### Testing
- No test framework currently configured
- Future tests should use `clojure.test`
- Place tests in `apps/web/test/` with `*-test.clj` naming

## Mathematical Computing

### Emmy Integration
The project includes Emmy for symbolic computation:
- Calculus and algebra operations
- Physics simulations
- Mathematical visualizations
- Interactive mathematical exploration

Examples available in `docs/emmy.clj`.

### SICM (Structure and Interpretation of Classical Mechanics)
The project includes study materials for SICM:
- Navigation page at `pages/sicm.clj`
- Exercise solutions in `pages/learning/` subdirectory
- Markdown source files stored in `books/sicm/` (project root)
- Clerk reader notebooks in `apps/web/books/sicm/` that render the markdown files
- Reader notebooks use dynamic path resolution via `user.dir` to locate markdown files
- Uses Emmy for mathematical computations related to classical mechanics

#### Adding New SICM Chapters
To add a new chapter to the SICM reader:
1. Add markdown files to `books/sicm/` (e.g., `2.0-chapter-name.md`)
2. Create a new reader notebook in `apps/web/books/sicm/` (e.g., `ch2.clj`)
3. Use the same `read-md` pattern to load markdown files
4. Update `apps/web/books/sicm/contents.clj` to add chapter link
5. The markdown files support LaTeX math and code blocks

## Common Issues

### Dependencies
- Run `pnpm install` if fonts are missing
- Clojure dependencies are handled by CLI tools

### Server Issues
- Check if port 7777 is available
- Use `(clerk/halt!)` to stop hanging server
- Restart with `clojure -M:dev` or `clojure -M:run`

### Build Issues
- Ensure all notebooks have valid Clojure syntax
- Check `deps.edn` for correct dependency versions
- Verify file paths in build configuration